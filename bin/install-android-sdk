#!/bin/bash
# QT-CI Project
# License: Apache-2.0
# https://github.com/benlau/qtci

# Install Android SDK to current folder

set -e #quit on error

if [ $# -lt 1 ];
then
    echo install-android-sdk packages
    echo
    echo Example:
    echo     install-android-sdk platform-tool,build-tools-20.0.0,android-19
    exit -1
fi

ANDROID_SDK_ROOT=${ANDROID_SDK_ROOT:=/tools}
NDK_VERSION=${NDK_VERSION:=r17c}

# e.g: platform-tool,build-tools-20.0.0,android-19
PACKAGES=$1

#echo Downloading Android SDK...
#wget -c -nv https://dl.google.com/android/repository/sdk-tools-linux-4333796.zip

echo Downloading Android NDK...
wget -c -nv https://dl.google.com/android/repository/android-ndk-${NDK_VERSION}-linux-x86_64.zip

#echo Extacting Android SDK...
#unzip -q sdk-tools-linux-4333796.zip

echo "Fix Malformed input or input contains unmappable characters: /usr/share/ca-certificates/mozilla/NetLock_Arany_=Class_Gold="
rm -vf /usr/share/ca-certificates/mozilla/NetLock_Arany*
rm -vf /usr/lib/ssl/certs/NetLock_Arany_=Class_Gold=_F*

echo Installing Android NDK...
(unzip -q android-ndk-${NDK_VERSION}-linux-x86_64.zip)

echo Android SDK and NDK installed
#/tools/platform-tools/adb kill-server

echo Remove downloaded files
rm  -vf /*.zip

#Install SDK tools and accept licenses
ls -la && curl -Lo /tmp/sdk-tools.zip 'https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip' \
   && unzip -q /tmp/sdk-tools.zip -d ${ANDROID_SDK_ROOT} \
   && rm -fv /tmp/sdk-tools.zip \
   && export PATH=${ANDROID_SDK_ROOT}/tools/bin/:$PATH \
   && yes | sdkmanager --licenses && sdkmanager --update
